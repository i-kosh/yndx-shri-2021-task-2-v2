!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var s=e();for(var a in s)("object"==typeof exports?exports:t)[a]=s[a]}}(this,(function(){return(()=>{"use strict";var t={d:(e,s)=>{for(var a in s)t.o(s,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:s[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{default:()=>u,prepareData:()=>u});const s=(t,e)=>{t.forEach((t=>{const s=t.id;e.has(s)||e.set(s,t)}))},a=(t,e)=>{const r=new Map,n=new Map,o=new Map,i=new Map,u=new Map,m=new Map,c=new Map;let d;return t.forEach((t=>{switch(t.type){case"Commit":r.has(t.id)||(r.set(t.id,t),"number"!=typeof t.author&&s(a([t.author]).parsed.users,n),Array.isArray(t.summaries)||s(a([t.summaries]).parsed.summarys,c));break;case"Comment":m.has(t.id)||(m.set(t.id,t),"number"!=typeof t.author&&s(a([t.author]).parsed.users,n),t.likes.forEach((t=>{"number"!=typeof t&&s(a([t]).parsed.users,n)})));break;case"Issue":u.has(t.id)||(u.set(t.id,t),t.resolvedBy&&"number"!=typeof t.resolvedBy&&s(a([t.resolvedBy]).parsed.users,n),t.comments.forEach((t=>{"string"!=typeof t&&s(a([t]).parsed.comments,m)})));break;case"Project":i.has(t.id)||(i.set(t.id,t),t.commits.forEach((t=>{"string"!=typeof t&&s(a([t]).parsed.commits,r)})),t.issues.forEach((t=>{"string"!=typeof t&&s(a([t]).parsed.issues,u)})),t.dependencies.forEach((t=>{"string"!=typeof t&&s(a([t]).parsed.projects,i)})));break;case"Sprint":o.has(t.id)||o.set(t.id,t),!d&&e&&t.id===e&&(d=t);break;case"User":n.has(t.id)||(n.set(t.id,t),t.friends.forEach((t=>{"number"!=typeof t&&s(a([t]).parsed.users,n)})),t.comments&&t.comments.forEach((t=>{"string"!=typeof t&&s(a([t]).parsed.comments,m)})),t.commits&&t.commits.forEach((t=>{"string"!=typeof t&&s(a([t]).parsed.commits,r)})));break;case"Summary":c.has(t.id)||(c.set(t.id,t),t.comments&&t.comments.forEach((t=>{"string"!=typeof t&&s(a([t]).parsed.comments,m)})))}})),{parsed:{comments:m,commits:r,issues:u,projects:i,sprints:o,summarys:c,users:n},currentSprint:d}},r=a;function n(t,e){const s=Math.abs(t);return e[s%10==1&&s%100!=11?0:s%10>=2&&s%10<=4&&(s%100<10||s%100>=20)?1:2]}function o(t){return 0===t?"0":t>0?`+${t}`:`${t}`}function i(t,e,s,a){let r=0;e.summaries.forEach((t=>{if("number"==typeof t){const e=null==s?void 0:s.get(t);e&&(r=r+e.added+e.removed)}else r=r+t.added+t.removed}));for(const e of t)if(r>=e.min&&r<=e.max){a?e.prevCommitsCount++:e.currentCommitsCount++;break}return t}function u(t=[],e={sprintId:0}){const{parsed:{comments:s,commits:a,sprints:u,summarys:m,users:c},currentSprint:d}=r(t,e.sprintId),f=function(t,e,s){const a={alias:"leaders",data:{title:"Больше всего коммитов",subtitle:`${(null==t?void 0:t.name)||""}`,emoji:"👑",users:[]}},r=new Map;t&&e&&s&&e.forEach((e=>{if(e.timestamp>=t.startAt&&e.timestamp<=t.finishAt){const t="number"!=typeof e.author?e.author:s.get(e.author);if(!t)return void console.warn("автор не найден");const a=r.get(t);if(a)a.add(e);else{const s=new Set;r.set(t,s.add(e))}}}));for(const t of r){const e=t[0],s=t[1];a.data.users.push({id:e.id,name:e.name,avatar:e.avatar,valueText:`${s.size}`})}return a.data.users.length<1&&(null==s||s.forEach((t=>{a.data.users.push({id:t.id,name:t.name,avatar:t.avatar,valueText:"0 голосов"})}))),a.data.users.sort(((t,e)=>{const s=parseInt(e.valueText)-parseInt(t.valueText);return 0===s?t.id-e.id:s})),a}(d,a,c);return[f,function(t,e,s){const a={alias:"vote",data:{title:"Самый 🔎 внимательный разработчик",emoji:"🔎",subtitle:(null==t?void 0:t.name)||"",users:[]}},r=new Map;t&&e&&s&&e.forEach((e=>{const a="number"!=typeof e.author?e.author:s.get(e.author);if(!a)return void console.warn("автор не найден");const n=r.get(a);null==n&&r.set(a,0),((t,e)=>t.createdAt>=e.startAt&&t.createdAt<=e.finishAt)(e,t)&&r.set(a,(n||0)+e.likes.length)}));for(const t of r){const e=t[0],s=t[1];a.data.users.push({id:e.id,name:e.name,avatar:e.avatar,valueText:`${s} ${n(s,["голос","голоса","голосов"])}`})}return a.data.users.sort(((t,e)=>parseInt(e.valueText)-parseInt(t.valueText))),a}(d,s,c),function(t,e,s,a){const r={alias:"chart",data:{subtitle:(null==t?void 0:t.name)||"",title:"Коммиты",users:e||[],values:[]}},n=new Map;t&&s&&a&&a.forEach((t=>{for(const e of s){const s=e[1];if(n.has(s)||n.set(s,0),t.timestamp>=s.startAt&&t.timestamp<=s.finishAt){const t=n.get(s)||0;n.set(s,t+1);break}}}));for(const e of n){const s=e[0],a=e[1],n={title:`${s.id}`,value:a,hint:s.name};(null==t?void 0:t.id)===s.id&&(n.active=!0),r.data.values.push(n)}return r.data.values.sort(((t,e)=>parseInt(t.title)-parseInt(e.title))),r}(d,f.data.users,u,a),function(t,e,s,a){const r=["коммит","коммита","коммитов"],u={alias:"diagram",data:{title:"Размер коммитов",subtitle:(null==t?void 0:t.name)||"",totalText:"",differenceText:"",categories:[]}},m=[{title:"> 1001 строки",min:1001,max:1/0,currentCommitsCount:0,prevCommitsCount:0},{title:"501 — 1000 строк",min:501,max:1e3,currentCommitsCount:0,prevCommitsCount:0},{title:"101 — 500 строк",min:101,max:500,currentCommitsCount:0,prevCommitsCount:0},{title:"1 — 100 строк",min:1,max:100,currentCommitsCount:0,prevCommitsCount:0}];if(t&&e&&s){const c=e.get(t.id-1),d=[],f=[];s.forEach((e=>{e.timestamp<=t.finishAt&&e.timestamp>=t.startAt&&(d.push(e),i(m,e,a)),c&&e.timestamp<=c.finishAt&&e.timestamp>=c.startAt&&(f.push(e),i(m,e,a,!0))})),u.data.totalText=`${d.length} ${n(d.length,r)}`;const l=d.length-f.length;u.data.differenceText=`${o(l)} с прошлого спринта`}return m.forEach((t=>{const e=t.currentCommitsCount-t.prevCommitsCount;u.data.categories.push({title:t.title,valueText:`${t.currentCommitsCount} ${n(t.currentCommitsCount,r)}`,differenceText:`${o(e)} ${n(e,r)}`})})),u}(d,u,a,m),function(t,e){const s=["sun","mon","tue","wed","thu","fri","sat"],a={alias:"activity",data:{title:"Коммиты, 1 неделя",subtitle:(null==t?void 0:t.name)||"",data:{mon:new Array(24).fill(0),tue:new Array(24).fill(0),wed:new Array(24).fill(0),thu:new Array(24).fill(0),fri:new Array(24).fill(0),sat:new Array(24).fill(0),sun:new Array(24).fill(0)}}};return t&&e&&e.forEach((e=>{if(e.timestamp>=t.startAt&&e.timestamp<=t.finishAt){const t=new Date(e.timestamp),r=t.getHours(),n=t.getDay();a.data.data[s[n]][r]++}})),a}(d,a)]}return e})()}));