!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var s=e();for(var r in s)("object"==typeof exports?exports:t)[r]=s[r]}}(this,(function(){return(()=>{"use strict";var t={d:(e,s)=>{for(var r in s)t.o(s,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:s[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{default:()=>m,prepareData:()=>m});const s=(t,e)=>{t.forEach((t=>{const s=t.id;e.has(s)||e.set(s,t)}))},r=(t,e)=>{const a=new Map,n=new Map,o=new Map,i=new Map,m=new Map,u=new Map,c=new Map;let d;return t.forEach((t=>{switch(t.type){case"Commit":a.has(t.id)||(a.set(t.id,t),"number"!=typeof t.author&&s(r([t.author]).parsed.users,n),Array.isArray(t.summaries)||s(r([t.summaries]).parsed.summarys,c));break;case"Comment":u.has(t.id)||(u.set(t.id,t),"number"!=typeof t.author&&s(r([t.author]).parsed.users,n),t.likes.forEach((t=>{"number"!=typeof t&&s(r([t]).parsed.users,n)})));break;case"Issue":m.has(t.id)||(m.set(t.id,t),t.resolvedBy&&"number"!=typeof t.resolvedBy&&s(r([t.resolvedBy]).parsed.users,n),t.comments.forEach((t=>{"string"!=typeof t&&s(r([t]).parsed.comments,u)})));break;case"Project":i.has(t.id)||(i.set(t.id,t),t.commits.forEach((t=>{"string"!=typeof t&&s(r([t]).parsed.commits,a)})),t.issues.forEach((t=>{"string"!=typeof t&&s(r([t]).parsed.issues,m)})),t.dependencies.forEach((t=>{"string"!=typeof t&&s(r([t]).parsed.projects,i)})));break;case"Sprint":o.has(t.id)||o.set(t.id,t),!d&&e&&t.id===e&&(d=t);break;case"User":n.has(t.id)||(n.set(t.id,t),t.friends.forEach((t=>{"number"!=typeof t&&s(r([t]).parsed.users,n)})),t.comments&&t.comments.forEach((t=>{"string"!=typeof t&&s(r([t]).parsed.comments,u)})),t.commits&&t.commits.forEach((t=>{"string"!=typeof t&&s(r([t]).parsed.commits,a)})));break;case"Summary":c.has(t.id)||(c.set(t.id,t),t.comments&&t.comments.forEach((t=>{"string"!=typeof t&&s(r([t]).parsed.comments,u)})))}})),{parsed:{comments:u,commits:a,issues:m,projects:i,sprints:o,summarys:c,users:n},currentSprint:d}},a=r;function n(t,e){const s=Math.abs(t);return e[s%10==1&&s%100!=11?0:s%10>=2&&s%10<=4&&(s%100<10||s%100>=20)?1:2]}function o(t){return 0===t?"0":t>0?`+${t}`:`${t}`}function i(t,e,s,r){let a=0;e.summaries.forEach((t=>{if("number"==typeof t){const e=null==s?void 0:s.get(t);e&&(a=a+e.added+e.removed)}else a=a+t.added+t.removed}));for(const e of t)if(a>=e.min&&a<=e.max){r?e.prevCommitsCount++:e.currentCommitsCount++;break}return t}function m(t=[],e={sprintId:0}){const{parsed:{comments:s,commits:r,sprints:m,summarys:u,users:c},currentSprint:d}=a(t,e.sprintId),f=function(t,e,s){const r={alias:"leaders",data:{title:"Больше всего коммитов",subtitle:`${(null==t?void 0:t.name)||""}`,emoji:"👑",users:[]}},a=new Map;t&&e&&s&&e.forEach((e=>{if(e.timestamp>=t.startAt&&e.timestamp<=t.finishAt){const t="number"!=typeof e.author?e.author:s.get(e.author);if(!t)return void console.warn("автор не найден");const r=a.get(t);if(r)r.add(e);else{const s=new Set;a.set(t,s.add(e))}}}));for(const t of a){const e=t[0],s=t[1];r.data.users.push({id:e.id,name:e.name,avatar:e.avatar,valueText:`${s.size}`})}return r.data.users.sort(((t,e)=>{const s=parseInt(e.valueText)-parseInt(t.valueText);return 0===s?t.id-e.id:s})),r}(d,r,c);return[f,function(t,e,s){const r={alias:"vote",data:{title:"Самый 🔎 внимательный разработчик",emoji:"🔎",subtitle:(null==t?void 0:t.name)||"",users:[]}},a=new Map;t&&e&&s&&e.forEach((e=>{if(e.createdAt>=t.startAt&&e.createdAt<=t.finishAt){const t="number"!=typeof e.author?e.author:s.get(e.author);if(!t)return void console.warn("автор не найден");if(e.likes.length>=1){const s=a.get(t);a.set(t,(s||0)+e.likes.length)}}}));for(const t of a){const e=t[0],s=t[1];r.data.users.push({id:e.id,name:e.name,avatar:e.avatar,valueText:`${s} ${n(s,["голос","голоса","голосов"])}`})}return r.data.users.sort(((t,e)=>parseInt(e.valueText)-parseInt(t.valueText))),r}(d,s,c),function(t,e,s,r){const a={alias:"chart",data:{subtitle:(null==t?void 0:t.name)||"",title:"Коммиты",users:e||[],values:[]}},n=new Map;t&&s&&r&&r.forEach((t=>{for(const e of s){const s=e[1];if(n.has(s)||n.set(s,0),t.timestamp>=s.startAt&&t.timestamp<=s.finishAt){const t=n.get(s)||0;n.set(s,t+1);break}}}));for(const e of n){const s=e[0],r=e[1],n={title:`${s.id}`,value:r,hint:s.name};(null==t?void 0:t.id)===s.id&&(n.active=!0),a.data.values.push(n)}return a.data.values.sort(((t,e)=>parseInt(t.title)-parseInt(e.title))),a}(d,f.data.users,m,r),function(t,e,s,r){const a=["коммит","коммита","коммитов"],m={alias:"diagram",data:{title:"Размер коммитов",subtitle:(null==t?void 0:t.name)||"",totalText:"",differenceText:"",categories:[]}},u=[{title:"> 1001 строки",min:1001,max:1/0,currentCommitsCount:0,prevCommitsCount:0},{title:"501 — 1000 строк",min:501,max:1e3,currentCommitsCount:0,prevCommitsCount:0},{title:"101 — 500 строк",min:101,max:500,currentCommitsCount:0,prevCommitsCount:0},{title:"1 — 100 строк",min:1,max:100,currentCommitsCount:0,prevCommitsCount:0}];if(t&&e&&s){const c=e.get(t.id-1),d=[],f=[];s.forEach((e=>{e.timestamp<=t.finishAt&&e.timestamp>=t.startAt&&(d.push(e),i(u,e,r)),c&&e.timestamp<=c.finishAt&&e.timestamp>=c.startAt&&(f.push(e),i(u,e,r,!0))})),m.data.totalText=`${d.length} ${n(d.length,a)}`;const l=d.length-f.length;m.data.differenceText=`${o(l)} с прошлого спринта`}return u.forEach((t=>{const e=t.currentCommitsCount-t.prevCommitsCount;m.data.categories.push({title:t.title,valueText:`${t.currentCommitsCount} ${n(t.currentCommitsCount,a)}`,differenceText:`${o(e)} ${n(e,a)}`})})),m}(d,m,r,u),function(t,e){const s=["sun","mon","tue","wed","thu","fri","sat"],r={alias:"activity",data:{title:"Коммиты, 1 неделя",subtitle:(null==t?void 0:t.name)||"",data:{fri:new Array(24).fill(0),mon:new Array(24).fill(0),sat:new Array(24).fill(0),sun:new Array(24).fill(0),thu:new Array(24).fill(0),tue:new Array(24).fill(0),wed:new Array(24).fill(0)}}};return t&&e&&e.forEach((e=>{if(e.timestamp>=t.startAt&&e.timestamp<=t.finishAt){const t=new Date(e.timestamp),a=t.getHours(),n=t.getDay();r.data.data[s[n]][a]++}})),r}(d,r)]}return e})()}));